%h2
  Item Details
%div.action_buttons.float_right
  -if @user.can_activate?(item) or @user.name == "admin"
    -if item.active?
      %form{:action => "/item/#{item.id}/act_deact/false", :method => "POST"}
        %input.styled-button{:type => "submit", :value => "Deactivate", :text => "deacBtn"}
    -else
      %form{:action => "/item/#{item.id}/act_deact/true", :method => "POST"}
        %input.styled-button{:type => "submit", :value => "Activate", :text => "deacBtn"}
  -if @user.can_edit?(item) or @user.name == "admin"
    %a.styled-button{:href => "/item/#{item.id}/edit"} Edit
  -if @user.can_delete?(item)
    %form{:action => "/item/#{item.id}", :method => "POST"}
      %input{:name => "_method", :type => "hidden", :value => "delete"}
      %input.styled-button.delete-color{:type => "submit", :value => "Delete", :text => "delBtn"}
  -if @user.can_buy?(item)
    %form{:action => "/user/buy/#{item.id}", :method => "POST"}
      %input.styled-button.buy-color{:type => "submit", :value => @user.on_behalf_of == @user ? "Buy" : "Buy as #{@user.on_behalf_of.name}"}
%h4
  -if item.active?
    This item is currently being traded
  -else
    This item is currently not being traded
%div#item_details
  %div.picture_container
    %img{:src => "#{item.image_path}", :width => "200"}
  %div.details_container
    %h3.no_top_margin
      Name
    %p
      :escaped
        #{item.name}
    %h3
      Price
    %p
      #{item.price}
    %h3
      Owner
    %p
      :escaped
        #{item.owner.name}
%h3
  Description
-if item.description == ""
  %p
    No description available
-else
  %div.markdown_view
    =marked_down_description
  %br(clear="all")
%table.table-comments
  %thead
    %tr
      %th
        %h3#comments Comments
  %tbody
    -for comment in item.comments
      %tr
        %td
          %div.comment_picture_container
            %img{:src => "#{comment.owner.image_path}", :width => "50", :height => "50"}
          -if comment.owner == @user
            %form{:action => "/item/#{item.id}/delete_comment/#{comment.id}", :method => "POST"}
              %input.styled-button.float_right.delete-color{:type => "submit", :value => "Delete"}
          %h4
            -if comment.owner.is_organization?
              %a{:href => url("/organization/#{comment.owner.name}")}
                :escaped
                  #{comment.owner.name}
            -else
              %a{:href => url("/user/#{comment.owner.name}")}
                :escaped
                  #{comment.owner.name}
            wrote at: #{comment.time_stamp}
          %br
          %div.markdown_view
            = RDiscount.new(comment.format_description, :smart, :filter_html).to_html
    %tr
      %td.textarea
        %div.smiley-view
          %img{:src => "/images/smileys/smile.gif" , :onclick => "addSmiley(':)', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/laugh.gif" , :onclick => "addSmiley(':D', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/cool.gif" , :onclick => "addSmiley('8)', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/double_minded.gif" , :onclick => "addSmiley(':/', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/disappointed.gif" , :onclick => "addSmiley(':(', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/sad.gif" , :onclick => "addSmiley(':,(', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/shocked.gif" , :onclick => "addSmiley(':O', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/crazy.gif" , :onclick => "addSmiley(':crazy:', 'comment_input')", :alt => "Smile" ,:border=>"0"}
          %img{:src => "/images/smileys/yeah.gif" , :onclick => "addSmiley(':yeah:', 'comment_input')", :alt => "Smile" ,:border=>"0"}
        %form{:action => "/item/#{item.id}/add_comment", :method => "POST", :onsubmit => "return validate_comment(this);"}
          %textarea.textbox8.comment{:name => "item_comment", :id => "comment_input"}
          %tr
            %td
              %input.styled-button.float_right{:type => "submit", :value => "Comment"}
:javascript
  function addSmiley(txt, id) {
  var div = document.getElementById(id);
  div.value += '' +txt+ ' ';
  }